/*!
* SlickQuiz jQuery Plugin
* http://github.com/jewlofthelotus/SlickQuiz
*
* @updated October 25, 2014
* @version 1.5.20
*
* @author Julie Cameron - http://www.juliecameron.com
* @copyright (c) 2013 Quicken Loans - http://www.quickenloans.com
* @license MIT
*/(function($){$.slickQuiz=function(element,options){var plugin=this,$element=$(element),_element='#'+$element.attr('id'),defaults={checkAnswerText:'Check My Answer!',nextQuestionText:'Next &raquo;',backButtonText:'',completeQuizText:'',tryAgainText:'',questionCountText:'Question %current of %total',preventUnansweredText:'You must select at least one answer.',questionTemplateText:'%count. %text',scoreTemplateText:'%score / %total',nameTemplateText:'<span>Quiz: </span>%name',skipStartButton:false,numberOfQuestions:null,randomSortQuestions:false,randomSortAnswers:false,preventUnanswered:false,disableScore:false,disableRanking:false,scoreAsPercentage:false,perQuestionResponseMessaging:true,perQuestionResponseAnswers:false,completionResponseMessaging:false,displayQuestionCount:true,displayQuestionNumber:true,animationCallbacks:{setupQuiz:function(){},startQuiz:function(){},resetQuiz:function(){},checkAnswer:function(){},nextQuestion:function(){},backToQuestion:function(){},completeQuiz:function(){}},events:{onStartQuiz:function(options){},onCompleteQuiz:function(options){}}},questionCountClass='questionCount',questionGroupClass='questions',questionClass='question',answersClass='answers',responsesClass='responses',completeClass='complete',correctClass='correctResponse',incorrectClass='incorrectResponse',correctResponseClass='correct',incorrectResponseClass='incorrect',checkAnswerClass='checkAnswer',nextQuestionClass='nextQuestion',lastQuestionClass='lastQuestion',backToQuestionClass='backToQuestion',tryAgainClass='tryAgain',_questionCount='.'+questionCountClass,_questions='.'+questionGroupClass,_question='.'+questionClass,_answers='.'+answersClass,_answer='.'+answersClass+' li',_responses='.'+responsesClass,_response='.'+responsesClass+' li',_correct='.'+correctClass,_correctResponse='.'+correctResponseClass,_incorrectResponse='.'+incorrectResponseClass,_checkAnswerBtn='.'+checkAnswerClass,_nextQuestionBtn='.'+nextQuestionClass,_prevQuestionBtn='.'+backToQuestionClass,_tryAgainBtn='.'+tryAgainClass,_quizStarter=_element+' .startQuiz',_quizName=_element+' .quizName',_quizArea=_element+' .quizArea',_quizResults=_element+' .quizResults',_quizResultsCopy=_element+' .quizResultsCopy',_quizHeader=_element+' .quizHeader',_quizScore=_element+' .quizScore',_quizLevel=_element+' .quizLevel',$quizStarter=$(_quizStarter),$quizName=$(_quizName),$quizArea=$(_quizArea),$quizResults=$(_quizResults),$quizResultsCopy=$(_quizResultsCopy),$quizHeader=$(_quizHeader),$quizScore=$(_quizScore),$quizLevel=$(_quizLevel);var depMsg='';if(options&&typeof options.disableNext!='undefined'){if(typeof options.preventUnanswered=='undefined'){options.preventUnanswered=options.disableNext;}
depMsg+='The \'disableNext\' option has been deprecated, please use \'preventUnanswered\' in it\'s place.\n\n';}
if(options&&typeof options.disableResponseMessaging!='undefined'){if(typeof options.preventUnanswered=='undefined'){options.perQuestionResponseMessaging=options.disableResponseMessaging;}
depMsg+='The \'disableResponseMessaging\' option has been deprecated, please use'+
' \'perQuestionResponseMessaging\' and \'completionResponseMessaging\' in it\'s place.\n\n';}
if(options&&typeof options.randomSort!='undefined'){if(typeof options.randomSortQuestions=='undefined'){options.randomSortQuestions=options.randomSort;}
if(typeof options.randomSortAnswers=='undefined'){options.randomSortAnswers=options.randomSort;}
depMsg+='The \'randomSort\' option has been deprecated, please use'+
' \'randomSortQuestions\' and \'randomSortAnswers\' in it\'s place.\n\n';}
if(depMsg!==''){if(typeof console!='undefined'){console.warn(depMsg);}else{alert(depMsg);}}
plugin.config=$.extend(defaults,options);var quizValues=(plugin.config.json?plugin.config.json:typeof quizJSON!='undefined'?quizJSON:null);var questions=plugin.config.randomSortQuestions?quizValues.questions.sort(function(){return(Math.round(Math.random())-0.5);}):quizValues.questions;var questionCount=questions.length;if(plugin.config.numberOfQuestions&&questionCount>=plugin.config.numberOfQuestions){questions=questions.slice(0,plugin.config.numberOfQuestions);questionCount=questions.length;}
var internal={method:{getKey:function(notches){var key=[];for(i=0;i<notches;i++)key[i]=$.Deferred();return key;},turnKeyAndGo:function(key,go){$.when.apply(null,key).then(function(){go();});},getKeyNotch:function(key,notch){return function(){key[notch-1].resolve();};}}};plugin.method={setupQuiz:function(options){var key,keyNotch,kN;key=internal.method.getKey(3);keyNotch=internal.method.getKeyNotch;kN=keyNotch;$quizName.hide().html(plugin.config.nameTemplateText.replace('%name',quizValues.info.name)).fadeIn(1000,kN(key,1));$quizHeader.hide().prepend($('<div class="quizDescription">'+quizValues.info.main+'</div>')).fadeIn(1000,kN(key,2));$quizResultsCopy.append(quizValues.info.results);if(plugin.config.tryAgainText&&plugin.config.tryAgainText!==''){$quizResultsCopy.append('<p><a class="button '+tryAgainClass+'" href="#">'+plugin.config.tryAgainText+'</a></p>');}
var quiz=$('<ol class="'+questionGroupClass+'"></ol>'),count=1;for(i in questions){if(questions.hasOwnProperty(i)){var question=questions[i];var questionHTML=$('<li class="'+questionClass+'" id="question'+(count-1)+'"></li>');if(plugin.config.displayQuestionCount){questionHTML.append('<div class="'+questionCountClass+'">'+
plugin.config.questionCountText.replace('%current','<span class="current">'+count+'</span>').replace('%total','<span class="total">'+
questionCount+'</span>')+'</div>');}
var formatQuestion='';if(plugin.config.displayQuestionNumber){formatQuestion=plugin.config.questionTemplateText.replace('%count',count).replace('%text',question.q);}else{formatQuestion=question.q;}
questionHTML.append('<h3>'+formatQuestion+'</h3>');var truths=0;for(i in question.a){if(question.a.hasOwnProperty(i)){answer=question.a[i];if(answer.correct){truths++;}}}
var answerHTML=$('<ul class="'+answersClass+'"></ul>');var answers=plugin.config.randomSortAnswers?question.a.sort(function(){return(Math.round(Math.random())-0.5);}):question.a;var selectAny=question.select_any?question.select_any:false,forceCheckbox=question.force_checkbox?question.force_checkbox:false,checkbox=(truths>1&&!selectAny)||forceCheckbox,inputName=$element.attr('id')+'_question'+(count-1),inputType=checkbox?'checkbox':'radio';if(count==quizValues.questions.length){nextQuestionClass=nextQuestionClass+' '+lastQuestionClass;}
for(i in answers){if(answers.hasOwnProperty(i)){answer=answers[i],optionId=inputName+'_'+i.toString();var input='<input id="'+optionId+'" name="'+inputName+
'" type="'+inputType+'" /> ';var optionLabel='<label for="'+optionId+'">'+answer.option+'</label>';var answerContent=$('<li></li>').append(input).append(optionLabel);answerHTML.append(answerContent);}}
questionHTML.append(answerHTML);if(plugin.config.perQuestionResponseMessaging||plugin.config.completionResponseMessaging){var responseHTML=$('<ul class="'+responsesClass+'"></ul>');responseHTML.append('<li class="'+correctResponseClass+'">'+question.correct+'</li>');responseHTML.append('<li class="'+incorrectResponseClass+'">'+question.incorrect+'</li>');questionHTML.append(responseHTML);}
if(plugin.config.backButtonText&&plugin.config.backButtonText!==''){questionHTML.append('<a href="#" class="button '+backToQuestionClass+'">'+plugin.config.backButtonText+'</a>');}
var nextText=plugin.config.nextQuestionText;if(plugin.config.completeQuizText&&count==questionCount){nextText=plugin.config.completeQuizText;}
if(!plugin.config.perQuestionResponseMessaging){questionHTML.append('<a href="#" class="button '+nextQuestionClass+' '+checkAnswerClass+'">'+nextText+'</a>');}else{questionHTML.append('<a href="#" class="button '+nextQuestionClass+'">'+nextText+'</a>');questionHTML.append('<a href="#" class="button '+checkAnswerClass+'">'+plugin.config.checkAnswerText+'</a>');}
quiz.append(questionHTML);count++;}}
$quizArea.append(quiz);if(plugin.config.skipStartButton||$quizStarter.length==0){$quizStarter.hide();plugin.method.startQuiz.apply(this,[{callback:plugin.config.animationCallbacks.startQuiz}]);kN(key,3).apply(null,[]);}else{$quizStarter.fadeIn(500,kN(key,3));}
internal.method.turnKeyAndGo(key,options&&options.callback?options.callback:function(){});},startQuiz:function(options){var key,keyNotch,kN;key=internal.method.getKey(1);keyNotch=internal.method.getKeyNotch;kN=keyNotch;function start(options){var firstQuestion=$(_element+' '+_questions+' li').first();if(firstQuestion.length){firstQuestion.fadeIn(500,function(){if(options&&options.callback)options.callback();});}}
if(plugin.config.skipStartButton||$quizStarter.length==0){start({callback:kN(key,1)});}else{$quizStarter.fadeOut(300,function(){start({callback:kN(key,1)});});}
internal.method.turnKeyAndGo(key,options&&options.callback?options.callback:function(){});if(plugin.config.events&&plugin.config.events.onStartQuiz){plugin.config.events.onStartQuiz.apply(null,[]);}},resetQuiz:function(startButton,options){var key,keyNotch,kN;key=internal.method.getKey(1);keyNotch=internal.method.getKeyNotch;kN=keyNotch;$quizResults.fadeOut(300,function(){$(_element+' input').prop('checked',false).prop('disabled',false);$quizLevel.attr('class','quizLevel');$(_element+' '+_question).removeClass(correctClass).removeClass(incorrectClass).remove(completeClass);$(_element+' '+_answer).removeClass(correctResponseClass).removeClass(incorrectResponseClass);$(_element+' '+_question+','+
_element+' '+_responses+','+
_element+' '+_response+','+
_element+' '+_nextQuestionBtn+','+
_element+' '+_prevQuestionBtn).hide();$(_element+' '+_questionCount+','+
_element+' '+_answers+','+
_element+' '+_checkAnswerBtn).show();$quizArea.append($(_element+' '+_questions)).show();kN(key,1).apply(null,[]);plugin.method.startQuiz({callback:plugin.config.animationCallbacks.startQuiz},$quizResults);});internal.method.turnKeyAndGo(key,options&&options.callback?options.callback:function(){});},checkAnswer:function(checkButton,options){var key,keyNotch,kN;key=internal.method.getKey(2);keyNotch=internal.method.getKeyNotch;kN=keyNotch;var questionLI=$($(checkButton).parents(_question)[0]),answerLIs=questionLI.find(_answers+' li'),answerSelects=answerLIs.find('input:checked'),questionIndex=parseInt(questionLI.attr('id').replace(/(question)/,''),10),answers=questions[questionIndex].a,selectAny=questions[questionIndex].select_any?questions[questionIndex].select_any:false;answerLIs.addClass(incorrectResponseClass);var trueAnswers=[];for(i in answers){if(answers.hasOwnProperty(i)){var answer=answers[i],index=parseInt(i,10);if(answer.correct){trueAnswers.push(index);answerLIs.eq(index).removeClass(incorrectResponseClass).addClass(correctResponseClass);}}}
var selectedAnswers=[];answerSelects.each(function(){var id=$(this).attr('id');selectedAnswers.push(parseInt(id.replace(/(.*\_question\d{1,}_)/,''),10));});if(plugin.config.preventUnanswered&&selectedAnswers.length===0){alert(plugin.config.preventUnansweredText);return false;}
var correctResponse=plugin.method.compareAnswers(trueAnswers,selectedAnswers,selectAny);if(correctResponse){questionLI.addClass(correctClass);}else{questionLI.addClass(incorrectClass);}
questionLI.find(correctResponse?_correctResponse:_incorrectResponse).show();if(plugin.config.perQuestionResponseMessaging){$(checkButton).hide();if(!plugin.config.perQuestionResponseAnswers){questionLI.find(_answers).hide({duration:0,complete:function(){questionLI.addClass(completeClass);}});}else{questionLI.addClass(completeClass);}
questionLI.find('input').prop('disabled',true);questionLI.find(_responses).show();questionLI.find(_nextQuestionBtn).fadeIn(300,kN(key,1));questionLI.find(_prevQuestionBtn).fadeIn(300,kN(key,2));if(!questionLI.find(_prevQuestionBtn).length)kN(key,2).apply(null,[]);}else{kN(key,1).apply(null,[]);kN(key,2).apply(null,[]);}
internal.method.turnKeyAndGo(key,options&&options.callback?options.callback:function(){});},nextQuestion:function(nextButton,options){var key,keyNotch,kN;key=internal.method.getKey(1);keyNotch=internal.method.getKeyNotch;kN=keyNotch;var currentQuestion=$($(nextButton).parents(_question)[0]),nextQuestion=currentQuestion.next(_question),answerInputs=currentQuestion.find('input:checked');if(plugin.config.preventUnanswered&&answerInputs.length===0){return false;}
if(nextQuestion.length){currentQuestion.fadeOut(300,function(){nextQuestion.find(_prevQuestionBtn).show().end().fadeIn(500,kN(key,1));if(!nextQuestion.find(_prevQuestionBtn).show().end().length)kN(key,1).apply(null,[]);});}else{kN(key,1).apply(null,[]);plugin.method.completeQuiz({callback:plugin.config.animationCallbacks.completeQuiz});}
internal.method.turnKeyAndGo(key,options&&options.callback?options.callback:function(){});},backToQuestion:function(backButton,options){var key,keyNotch,kN;key=internal.method.getKey(2);keyNotch=internal.method.getKeyNotch;kN=keyNotch;var questionLI=$($(backButton).parents(_question)[0]),responses=questionLI.find(_responses);if(responses.css('display')==='block'){questionLI.find(_responses).fadeOut(300,function(){questionLI.removeClass(correctClass).removeClass(incorrectClass).removeClass(completeClass);questionLI.find(_responses+', '+_response).hide();questionLI.find(_answers).show();questionLI.find(_answer).removeClass(correctResponseClass).removeClass(incorrectResponseClass);questionLI.find('input').prop('disabled',false);questionLI.find(_answers).fadeIn(500,kN(key,1));questionLI.find(_checkAnswerBtn).fadeIn(500,kN(key,2));questionLI.find(_nextQuestionBtn).hide();if(questionLI.attr('id')!='question0'){questionLI.find(_prevQuestionBtn).show();}else{questionLI.find(_prevQuestionBtn).hide();}});}else{var prevQuestion=questionLI.prev(_question);questionLI.fadeOut(300,function(){prevQuestion.removeClass(correctClass).removeClass(incorrectClass).removeClass(completeClass);prevQuestion.find(_responses+', '+_response).hide();prevQuestion.find(_answers).show();prevQuestion.find(_answer).removeClass(correctResponseClass).removeClass(incorrectResponseClass);prevQuestion.find('input').prop('disabled',false);prevQuestion.find(_nextQuestionBtn).hide();prevQuestion.find(_checkAnswerBtn).show();if(prevQuestion.attr('id')!='question0'){prevQuestion.find(_prevQuestionBtn).show();}else{prevQuestion.find(_prevQuestionBtn).hide();}
prevQuestion.fadeIn(500,kN(key,1));kN(key,2).apply(null,[]);});}
internal.method.turnKeyAndGo(key,options&&options.callback?options.callback:function(){});},completeQuiz:function(options){var key,keyNotch,kN;key=internal.method.getKey(1);keyNotch=internal.method.getKeyNotch;kN=keyNotch;var score=$(_element+' '+_correct).length,displayScore=score;if(plugin.config.scoreAsPercentage){displayScore=(score/questionCount).toFixed(2)*100+"%";}
if(plugin.config.disableScore){$(_quizScore).remove()}else{$(_quizScore+' span').html(plugin.config.scoreTemplateText.replace('%score',displayScore).replace('%total',questionCount));}
if(plugin.config.disableRanking){$(_quizLevel).remove()}else{var levels=[quizValues.info.level1,quizValues.info.level2,quizValues.info.level3,quizValues.info.level4,quizValues.info.level5],levelRank=plugin.method.calculateLevel(score),levelText=$.isNumeric(levelRank)?levels[levelRank]:'';$(_quizLevel+' span').html(levelText);$(_quizLevel).addClass('level'+levelRank);}
$quizArea.fadeOut(300,function(){if(plugin.config.completionResponseMessaging){$(_element+' .button:not('+_tryAgainBtn+'), '+_element+' '+_questionCount).hide();$(_element+' '+_question+', '+_element+' '+_answers+', '+_element+' '+_responses).show();$quizResults.append($(_element+' '+_questions)).fadeIn(500,kN(key,1));}else{$quizResults.fadeIn(500,kN(key,1));}});internal.method.turnKeyAndGo(key,options&&options.callback?options.callback:function(){});if(plugin.config.events&&plugin.config.events.onCompleteQuiz){plugin.config.events.onCompleteQuiz.apply(null,[{questionCount:questionCount,score:score}]);}},compareAnswers:function(trueAnswers,selectedAnswers,selectAny){if(selectAny){return $.inArray(selectedAnswers[0],trueAnswers)>-1;}else{return($(trueAnswers).not(selectedAnswers).length===0&&$(selectedAnswers).not(trueAnswers).length===0);}},calculateLevel:function(correctAnswers){var percent=(correctAnswers/questionCount).toFixed(2),level=null;if(plugin.method.inRange(0,0.20,percent)){level=4;}else if(plugin.method.inRange(0.21,0.40,percent)){level=3;}else if(plugin.method.inRange(0.41,0.60,percent)){level=2;}else if(plugin.method.inRange(0.61,0.80,percent)){level=1;}else if(plugin.method.inRange(0.81,1.00,percent)){level=0;}
return level;},inRange:function(start,end,value){return(value>=start&&value<=end);}};plugin.init=function(){plugin.method.setupQuiz.apply(null,[{callback:plugin.config.animationCallbacks.setupQuiz}]);$quizStarter.on('click',function(e){e.preventDefault();if(!this.disabled&&!$(this).hasClass('disabled')){plugin.method.startQuiz.apply(null,[{callback:plugin.config.animationCallbacks.startQuiz}]);}});$(_element+' '+_tryAgainBtn).on('click',function(e){e.preventDefault();plugin.method.resetQuiz(this,{callback:plugin.config.animationCallbacks.resetQuiz});});$(_element+' '+_checkAnswerBtn).on('click',function(e){e.preventDefault();plugin.method.checkAnswer(this,{callback:plugin.config.animationCallbacks.checkAnswer});});$(_element+' '+_prevQuestionBtn).on('click',function(e){e.preventDefault();plugin.method.backToQuestion(this,{callback:plugin.config.animationCallbacks.backToQuestion});});$(_element+' '+_nextQuestionBtn).on('click',function(e){e.preventDefault();plugin.method.nextQuestion(this,{callback:plugin.config.animationCallbacks.nextQuestion});});var _qnid=$element.attr('id')+'-name';$quizName.attr('id',_qnid);$element.attr({'aria-labelledby':_qnid,'aria-live':'polite','aria-relevant':'additions','role':'form'});$(_quizStarter+', [href = "#"]').attr('role','button');};plugin.init();};$.fn.slickQuiz=function(options){return this.each(function(){if(undefined===$(this).data('slickQuiz')){var plugin=new $.slickQuiz(this,options);$(this).data('slickQuiz',plugin);}});};})(jQuery);