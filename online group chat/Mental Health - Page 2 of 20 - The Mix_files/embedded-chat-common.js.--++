(function(a,c){var b=a.EmbeddedChat=a.EmbeddedChat||{};a.CONFIG={MAX_CHAT_MSG_LENGTH:5000};_.templateSettings={interpolate:/\{\{(.+?)\}\}/g,escape:/\{\{\{(.+?)\}\}\}/g};b.getCombinedHeight=_.partial(_.reduce,_,function(d,e){return d+c(e).outerHeight(true)},0);b.validateFieldLength=function(){var e=c(this),f=e.val(),d=e.attr("maxlength");if(f.length>d){e.val(f.substr(0,d))}};b.isPopup=function(){return false};b.doVerticalResize=function(f,h){var g=f.closest(".inner-container");var k=f.closest(".main");var d=k.siblings(".header,.footer,.error-server-unavailable:visible,acknowledge-text:visible");var e=this.getCombinedHeight(d);var i=this.getCombinedHeight(h);k.height(g.height()-e);if(h){var j=f.outerHeight(true)-f.height();f.height(k.height()-i-j)}};b.getDefaultWindowSize=function(){return{width:parseInt(this.windowProperties.width,10),height:parseInt(this.windowProperties.height.open,10)}};b.getWindowChromeSize=function(){return{width:window.outerWidth-window.innerWidth,height:window.outerHeight-window.innerHeight}};b.getWindowInnerSize=function(){return{width:window.innerWidth,height:window.innerHeight}};b.resizeWindow=function(d,k){if(k&&this.windowProperties){var e=this.getDefaultWindowSize();var j=d.prop("scrollHeight")-d.height();this.customWidth=e.width;this.customHeight=e.height+j;if(this.isPopup()){var g=this.getWindowChromeSize();var i=this.customWidth+g.width;var f=this.customHeight+g.height;window.resizeTo(i,f);window.setTimeout(_.bind(function(){var m=this.getWindowInnerSize();var l=this.customHeight-m.height;if(l>0){window.moveBy(0,-l);window.resizeTo(i,f)}window.setTimeout(_.bind(function(){this.customWidth=m.width;this.customHeight=m.height},this),0)},this),0)}else{var h=this.chatBrowserInfo.innerHeight;this.customHeight=this.customHeight>h?h:this.customHeight;this.sendMessage("chat:resize",{width:this.customWidth+"px",height:this.customHeight+"px"})}}};b.restorePopupSize=function(){var d=this.getDefaultWindowSize();var e=this.getWindowChromeSize();this.customWidth=d.width;this.customHeight=d.height;window.resizeTo(this.customWidth+e.width,this.customHeight+e.height)};b.canResize=function(e){var f=this.customWidth===undefined||this.customWidth==window.innerWidth;var d=this.customHeight===undefined||this.customHeight==window.innerHeight;return e&&(this.isPopup()?f&&d:true)};b.recalculateHeight=function(f){var h=c(".js-invitation-message:visible"),e=c(".js-form-list:visible"),d=c(".js-message-history:visible"),i=c(".confirm-close:visible"),g=c(".js-translation-header:visible");if(h.length){h.height(172-h.position().top)}if(e.length){this.resizeWindow(e,this.canResize(f));this.doVerticalResize(e,e.siblings("button"))}if(d.length){if(this.isPopup()&&this.canResize(f)){this.restorePopupSize()}if(g.length){this.doVerticalResize(d,d.siblings(".message-box, .translation-header"))}else{this.doVerticalResize(d,d.siblings(".message-box"))}}if(i.length){this.doVerticalResize(i)}};b.resetScroll=function(){c(".js-form-list").animate({scrollTop:0},"fast")};b.setupChatWindow=function(){var f=c(".js-message-actions");var h=f.find(".actions");var d=f.find(".js-flag");f.css("top",-(h.height()+1)+"px");d.click(function(j){j.preventDefault?j.preventDefault():j.returnValue=false;var i=f.position().top===0;f.animate({top:i?-(h.height()+1)+"px":0},300)});var g=c("#message-counter");if(g.length){g.html(CONFIG.MAX_CHAT_MSG_LENGTH);var e=c("#message-field");e.on("keyup",function(j){var k=CONFIG.MAX_CHAT_MSG_LENGTH;var i=e.val().length;var l=k-i;g.toggleClass("counter-limit",l<1);g.html(l)})}};b.modernize=function(d){var e=d?c(d):c("body");if(!("maxLength" in document.createElement("textarea"))){e.find("textarea[maxlength]").on("keydown keyup focus blur",this.validateFieldLength)}}})(this,jQuery);