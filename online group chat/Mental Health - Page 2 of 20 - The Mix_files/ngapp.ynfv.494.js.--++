angular.module('tmApp',['ngGeolocation','ngSanitize','ngCookies','ngAnimate']);(function(){'use strict';angular.module('tmApp').service('mCookie',mCookie);mCookie.$inject=['$cookies'];function mCookie($cookies){this.options={path:'/',expiryDate:null};this.name='mCookie';this.data={};this.options.expiryDate=new Date();this.options.expiryDate.setDate(this.options.expiryDate.getDate()+9999);this.get=function(key){this.getAll();return this.data[key];};this.getAll=function(){this.data=angular.fromJson($cookies.get(this.name))||{};return this.data;};this.set=function(key,val){this.getAll();this.data[key]=val;this.save();};this.delete=function(key){this.getAll();delete this.data[key];this.save();};this.deleteAll=function(){this.data={};this.save();};this.save=function(){$cookies.put(this.name,angular.toJson(this.data),this.options);};}})();(function(){'use strict';angular.module('tmApp').service('mLocalPages',mLocalPages);function mLocalPages(){this.getAll=function(){if(mAllLocalPages.length>0){return mAllLocalPages;}
return false;};this.get=function(id){return this.getAll().filter(function(obj){return obj.id===id;})[0];};this.nearest=function(location){if(this.getAll()){var nearest=geolib.findNearest({latitude:location.coords.latitude,longitude:location.coords.longitude},this.getAll());return mAllLocalPages[nearest.key];}
return false;};}})();(function(){'use strict';angular.module('tmApp').directive('newWindow',newWindow);function newWindow(){return{restrict:'A',link:function(scope,element,attrs){element.on('click',function(e){if(attrs.openNewWindow=="true"){e.preventDefault();$(element).openInNewWindow();}});}};}})();(function(){'use strict';angular.module('tmApp').directive('validatePostcodeFormat',validatePostcodeFormat);function validatePostcodeFormat(){var POSTCODE_PATTERNS=[/^([g][i][r]\s*?[0][a][a])$|^((([a-pr-uwyz]{1}([0]|[1-9]\d?))|([a-pr-uwyz]{1}[a-hk-y]{1}([0]|[1-9]\d?))|([a-pr-uwyz]{1}[1-9][a-hjkps-uw]{1})|([a-pr-uwyz]{1}[a-hk-y]{1}[1-9][a-z]{1}))\s*?(\d[abd-hjlnp-uw-z]{2})?)$/i];return{require:'ngModel',link:function($scope,element,attrs,ngModel){ngModel.$validators.postcodeFormat=function(value){var status=true;angular.forEach(POSTCODE_PATTERNS,function(pattern){if(value instanceof String){value=value.replace(/\s/g,'');}
status=status&&pattern.test(value);});return status;};}}}})();(function(){'use strict';angular.module('tmApp').service('authService',authService);authService.$inject=['$http','$httpParamSerializerJQLike'];function authService($http,$httpParamSerializerJQLike){this.version=1;this.login=function(form){return this.response('login',form);};this.signup=function(form){return this.response('signup',form);};this.response=function(endpoint,form){return $http({method:'POST',url:'/wp-json/wp/v2/'+endpoint,data:$httpParamSerializerJQLike(form),headers:{'Content-Type':'application/x-www-form-urlencoded'}});};}})();(function(){'use strict';angular.module('tmApp').controller('LightboxAuthController',LightboxAuthController);LightboxAuthController.$inject=['$scope','$http','$window','authService'];function LightboxAuthController($scope,$http,$window,authService){$scope.loginUser={};$scope.signupUser={};$scope.login=function(){authService.login($scope.loginUser).then(function(response){$scope.loginErrors=null;$scope.loginMessages=response.data.messages;$window.location.reload();},function(response){$scope.loginMessages={};$scope.loginErrors=response.data.errors;}).finally(function(){$scope.lightboxLoginForm.$setPristine();});};$scope.signup=function(){authService.signup($scope.signupUser).then(function(response){$scope.signupErrors=null;$scope.signupMessages=response.data.messages;$scope.loginMessages=response.data.messages;$scope.signupUser={};$scope.hideSignupForm=true;$.fancybox.jumpto(0);},function(response){$scope.signupMessages={};$scope.signupErrors=response.data.errors;}).finally(function(){$scope.lightboxSignupForm.$setPristine();});};}})();(function(){'use strict';angular.module('tmApp').controller('HeaderController',HeaderController);HeaderController.$inject=['mCookie','mLocalPages'];function HeaderController(mCookie,mLocalPages){var vm=this;vm.localPage=mCookie.get('localPage');if(vm.localPage&&!vm.localPage.short_name){mCookie.set('localPage',mLocalPages.get(vm.localPage.id));}
return vm;}})();(function(){'use strict';angular.module('tmApp').controller('LafSearchController',HeaderController);HeaderController.$inject=['$scope'];function HeaderController($scope){$scope.validateForm=function(e){if($scope.lafSearchForm.$invalid){$scope.lafErrors=true;e.preventDefault();}};}})();(function(){'use strict';angular.module('tmApp').controller('SetLocationController',SetLocationController);SetLocationController.$inject=['$scope','$window','$geolocation','mCookie','mLocalPages'];function SetLocationController($scope,$window,$geolocation,mCookie,mLocalPages){$scope.$geolocation=$geolocation;$scope.localPage=mCookie.get('localPage');$scope.locate=function(){$geolocation.getCurrentPosition().then(function(location){if(mLocalPages.getAll()){var nearest=mLocalPages.nearest(location);mCookie.set('localPage',nearest);$window.location.reload();}});};$scope.unsetLocalPage=function(){mCookie.delete('localPage');$window.location.reload();};$scope.setAsHome=function(id){var localPage=mLocalPages.get(id);if(localPage!==undefined){mCookie.set('localPage',localPage);$window.location.reload();}};}})();(function(){'use strict';angular.module('tmApp').controller('MemberProfileDetailsController',MemberProfileDetailsController);MemberProfileDetailsController.$inject=['$http','$httpParamSerializerJQLike'];function MemberProfileDetailsController($http,$httpParamSerializerJQLike){var vm=this;vm.user=memberData;vm.error=false;vm.message={};vm.setmeup=function(v){};vm.submitForm=function(){vm.processing=true;$http({method:'POST',url:apiSettings.root+'wp/v2/users/'+memberData.id,data:$httpParamSerializerJQLike(vm.user),headers:{'Content-Type':'application/x-www-form-urlencoded','X-WP-Nonce':apiSettings.nonce}}).then(function(data){window.location.reload();vm.error=false;},function(data){vm.error=data.data.code;console.error(data);}).finally(function(){vm.memberProfileFormDetails.$setPristine();});};return vm;}})();(function(){'use strict';angular.module('tmApp').controller('OneToOneChatController',OneToOneChatController);OneToOneChatController.$inject=['$scope'];function OneToOneChatController($scope){$scope.pForm={};$scope.launchChat=function(){var mods=[{uuid:"script_3339347585939264a55c622.61218547",channel:"The Mix (Chat)"}];var reason=0;window.__8x8Chat={uuid:mods[reason].uuid,tenant:"dGhlbWl4MDE",channel:mods[reason].channel,domain:"https://vcc-eu3.8x8.com",path:"/.",buttonContainerId:"__8x8-chat-button-container-"+mods[reason].uuid,align:"right",onInit:function(bus){bus.publish('customer:set-info',{age:$scope.pForm.age,email:$scope.pForm.email,ethnicity:$scope.pForm.ethnicity,firstname:$scope.pForm.firstname,gender:$scope.pForm.gender,howheard:$scope.pForm.howheard,feeling:$scope.pForm.feeling,area:$scope.pForm.area});}};(function(){var se=document.createElement("script");se.type="text/javascript";se.async=true;se.src=__8x8Chat.domain+__8x8Chat.path+"/CHAT/common/js/chat.js";var os=document.getElementsByTagName("script")[0];os.parentNode.insertBefore(se,os);})();var target=document.getElementById('__8x8-chat-button-container-'+mods[reason].uuid);var observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){if(mutation.type!=='childList')
return;buttonclick();observer.disconnect();});});var config={attributes:true,childList:true,characterData:true};observer.observe(target,config);function buttonclick(){var chatStartLink=jQuery(target).find('a');if(chatStartLink){jQuery.fancybox.close();jQuery(chatStartLink).click();}}};}})();(function(){'use strict';angular.module('tmApp').factory('triageApiService',triageApiService);triageApiService.$inject=['$http','triageService'];function triageApiService($http,triageService){return{version:1,getContent:function(section){return $http({method:'GET',url:'/wp-json/triage/v'+this.version+'/'+section,params:triageService.getForm()}).then(function(response){return response;});}}}})();(function(){'use strict';angular.module('tmApp').controller('TriageAppsAndToolsController',TriageAppsAndToolsController);TriageAppsAndToolsController.$inject=['$scope','$rootScope','triageApiService'];function TriageAppsAndToolsController($scope,$rootScope,triageApiService){$rootScope.$on('rootScope:triage:update',function(){triageApiService.getContent('apps-and-tools').then(function(response){$scope.posts=response.data;});});$rootScope.$on('rootScope:triage:clear',function(){$scope.posts=[];});}})();(function(){'use strict';angular.module('tmApp').controller('TriageCrisisController',TriageCrisisController);TriageCrisisController.$inject=['$scope','$rootScope','triageApiService'];function TriageCrisisController($scope,$rootScope,triageApiService){$rootScope.$on('rootScope:triage:update',function(){triageApiService.getContent('crisis').then(function(response){$scope.post=response.data;});});$rootScope.$on('rootScope:triage:clear',function(){$scope.post=[];});}})();(function(){'use strict';angular.module('tmApp').controller('TriageLearningController',TriageLearningController);TriageLearningController.$inject=['$scope','$rootScope','triageApiService'];function TriageLearningController($scope,$rootScope,triageApiService){$rootScope.$on('rootScope:triage:update',function(){triageApiService.getContent('learning').then(function(response){$scope.posts=response.data;});});$rootScope.$on('rootScope:triage:clear',function(){$scope.posts=[];});}})();(function(){'use strict';angular.module('tmApp').controller('TriageLocalPagesController',TriageLocalPagesController);TriageLocalPagesController.$inject=['$scope','$rootScope','triageApiService'];function TriageLocalPagesController($scope,$rootScope,triageApiService){$rootScope.$on('rootScope:triage:update',function(){triageApiService.getContent('local-pages').then(function(response){$scope.posts=response.data;});});$rootScope.$on('rootScope:triage:clear',function(){$scope.posts=[];});}})();(function(){'use strict';angular.module('tmApp').controller('TriageP2PController',TriageP2PController);TriageP2PController.$inject=['$scope','$rootScope','triageApiService'];function TriageP2PController($scope,$rootScope,triageApiService){$rootScope.$on('rootScope:triage:update',function(){triageApiService.getContent('p2p').then(function(response){$scope.posts=response.data;$scope.show=response.status!=401;});});$rootScope.$on('rootScope:triage:clear',function(){$scope.posts=[];$scope.show=false;});}})();(function(){'use strict';angular.module('tmApp').controller('TriageReadController',TriageReadController);TriageReadController.$inject=['$scope','$rootScope','triageApiService'];function TriageReadController($scope,$rootScope,triageApiService){$rootScope.$on('rootScope:triage:update',function(){triageApiService.getContent('read').then(function(response){$scope.posts=response.data;});});$rootScope.$on('rootScope:triage:clear',function(){$scope.posts=[];});}})();(function(){'use strict';angular.module('tmApp').controller('TriageSearchFormController',TriageSearchFormController);TriageSearchFormController.$inject=['$scope','$rootScope','triageService'];function TriageSearchFormController($scope,$rootScope,triageService){$scope.numberPattern='\\d+';$rootScope.$on('rootScope:triage:open',function(){triageService.restoreForm();$scope.triage=triageService.getForm();});}})();(function(){'use strict';angular.module('tmApp').factory('triageService',triageService);triageService.$inject=['mCookie'];function triageService(mCookie){return{visible:false,form:{search:'',location:''},sectionState:{},getForm:function(){return this.form;},setForm:function(form){if(!form.mood)
form.mood=4;this.form=form;mCookie.set('triageForm',this.getForm());},restoreForm:function(){var cookie=mCookie.getAll();if(cookie.triageForm){this.form=cookie.triageForm;}
if(!this.form.location&&cookie.localPage&&cookie.localPage.mgeolocation){this.form.location=cookie.localPage.mgeolocation;}},get:function(k){return this.form[k]||false;},getVisible:function(){return this.visible;},setVisible:function(){this.visible=true;},setHidden:function(){this.visible=false;},getSlideState:function(){return mCookie.get('slideState');},setSlideState:function(state){mCookie.set('slideState',state);}};}})();(function(){'use strict';angular.module('tmApp').controller('TriageSignpostController',TriageSignpostController);TriageSignpostController.$inject=['$scope','$rootScope','triageApiService'];function TriageSignpostController($scope,$rootScope,triageApiService){$rootScope.$on('rootScope:triage:update',function(){triageApiService.getContent('signpost').then(function(response){$scope.posts=response.data;});});$rootScope.$on('rootScope:triage:clear',function(){$scope.posts=[];});}})();(function(){'use strict';angular.module('tmApp').controller('TriageSpeakToOurAdvisorController',TriageSpeakToOurAdvisorController);TriageSpeakToOurAdvisorController.$inject=['$scope','$rootScope','triageApiService'];function TriageSpeakToOurAdvisorController($scope,$rootScope,triageApiService){$rootScope.$on('rootScope:triage:update',function(){triageApiService.getContent('speak-to-our-advisor').then(function(response){$scope.posts=response.data;});});$rootScope.$on('rootScope:triage:clear',function(){$scope.posts=[];});}})();(function(){'use strict';angular.module('tmApp').controller('TriageVolunteeringRolesController',TriageVolunteeringRolesController);TriageVolunteeringRolesController.$inject=['$scope','$rootScope','triageApiService'];function TriageVolunteeringRolesController($scope,$rootScope,triageApiService){$rootScope.$on('rootScope:triage:update',function(){triageApiService.getContent('volunteering-roles').then(function(response){$scope.posts=response.data;});});$rootScope.$on('rootScope:triage:clear',function(){$scope.posts=[];});}})();(function(){'use strict';angular.module('tmApp').controller('TriageWrapperController',TriageWrapperController);TriageWrapperController.$inject=['$scope','$rootScope','triageService','triageApiService'];function TriageWrapperController($scope,$rootScope,triageService,triageApiService){$scope.visible=triageService.getVisible();$scope.open=function(){triageService.setVisible();$scope.visible=triageService.getVisible();$rootScope.$broadcast('rootScope:triage:open');if(triageService.getSlideState()=='results')
$scope.goToResults(triageService.getForm());};$scope.close=function(){triageService.setHidden();$scope.visible=triageService.getVisible();};$scope.goToFrom=function(){triageService.setSlideState('form');$rootScope.$broadcast('rootScope:triage:clear');document.triage_slides.goToPrevSlide();};$scope.goToResults=function(form){triageService.setSlideState('results');triageService.setForm(form);$rootScope.$broadcast('rootScope:triage:update');document.triage_slides.goToNextSlide();};$rootScope.$on('rootScope:triage:update',function(){triageApiService.getContent('log').then(function(response){});});}})();(function(){'use strict';angular.module('tmApp').controller('WebformToSalesForceCounsellingForm',WebformToSalesForceCounsellingForm);WebformToSalesForceCounsellingForm.$inject=['$scope','$window'];function WebformToSalesForceCounsellingForm($scope,$window){$scope.e2sCap=false;var morningSlots=['09:00 - 09:30','09:30 - 10:00','10:00 - 10:30','10:30 - 11:00','11:00 - 11:30','11:30 - 12:00','12:00 - 12:30','12:30 - 13:00','13:00 - 13:30','13:30 - 14:00','14:00 - 14:30','14:30 - 15:00','15:00 - 15:30','15:30 - 16:00'];var eveningSlots=['16:00 - 16:30','16:30 - 17:00','17:00 - 17:30','17:30 - 18:00','18:00 - 18:30','18:30 - 19:00','19:00 - 19:30','19:30 - 20:00','20:00 - 20:30','20:30 - 21:00','21:00 - 21:30','21:30 - 22:00','22:00 - 22:30','22:30 - 23:00'];$scope.availableSlots=eveningSlots;$scope.setSlots=function(){$scope.availableSlots=$scope.sSessionTypeRequired==='Telephone Counselling'?morningSlots.concat(eveningSlots):eveningSlots;};}})();(function(){'use strict';angular.module('tmApp').controller('WebformToSalesForceEmailUs',WebformToSalesForceEmailUs);WebformToSalesForceEmailUs.$inject=['$scope','$window'];function WebformToSalesForceEmailUs($scope,$window){$scope.e2sCap=false;}})();(function(){'use strict';angular.module('tmApp').controller('WebformToSalesForceWebchatCounselling',WebformToSalesForceWebchatCounselling);WebformToSalesForceWebchatCounselling.$inject=['$scope','$window'];function WebformToSalesForceWebchatCounselling($scope,$window){$scope.e2sCap=false;var regularOpeningTimes=['16:00 - 16:30','16:30 - 17:00','17:00 - 17:30','17:30 - 18:00','18:00 - 18:30','18:30 - 19:00','19:00 - 19:30','19:30 - 20:00','20:00 - 20:30','20:30 - 21:00','21:00 - 21:30','21:30 - 22:00'];var extendedOpeningTimes=['09:00 - 09:30','09:30 - 10:00','10:00 - 10:30','10:30 - 11:00','11:00 - 11:30','11:30 - 12:00','12:00 - 12:30','12:30 - 13:00','13:00 - 13:30','13:30 - 14:00','14:00 - 14:30','14:30 - 15:00','15:00 - 15:30','15:30 - 16:00']+regularOpeningTimes;$scope.getTimes=function(){console.log(extendedOpeningTimes);}}})();